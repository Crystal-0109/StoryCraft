<!DOCTYPE html>
<html lang="ko">
    <head>
        <meta charset="utf-8" />
        <title>StoryCraft Editor</title>
        <meta name="viewport" content="width=device-width,initial-scale=1" />
        <meta name="description" content="" />
        <meta name="keywords" content="" />

        <!-- Favicons -->
        <link href="assets/img/favicon.png" rel="icon" />
        <link href="assets/img/apple-touch-icon.png" rel="apple-touch-icon" />

        <!-- Fonts -->
        <link href="https://fonts.googleapis.com" rel="preconnect" />
        <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin />
        <link
            href="https://fonts.googleapis.com/css2?family=Roboto:ital,wght@0,100;0,300;0,400;0,500;0,700;0,900;1,100;1,300;1,400;1,500;1,700;1,900&family=Lato:ital,wght@0,100;0,300;0,400;0,700;0,900;1,100;1,300;1,400;1,700;1,900&family=Nunito:ital,wght@0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&display=swap"
            rel="stylesheet"
        />

        <!-- Vendor CSS Files -->
        <link
            href="assets/vendor/bootstrap/css/bootstrap.min.css"
            rel="stylesheet"
        />
        <link
            href="assets/vendor/bootstrap-icons/bootstrap-icons.css"
            rel="stylesheet"
        />
        <link href="assets/vendor/aos/aos.css" rel="stylesheet" />
        <link
            href="assets/vendor/glightbox/css/glightbox.min.css"
            rel="stylesheet"
        />
        <link
            href="assets/vendor/swiper/swiper-bundle.min.css"
            rel="stylesheet"
        />

        <!-- Main CSS File -->
        <link href="assets/css/main.css" rel="stylesheet" />
        <!-- Quill -->
        <link
            href="https://cdn.jsdelivr.net/npm/quill@1.3.7/dist/quill.snow.css"
            rel="stylesheet"
        />
        <style>
            :root {
                --bg: #f7f7fb;
                --card: #fff;
                --muted: #666;
                --border: #e5e7eb;
                --accent: #4f46e5; /* ì£¼ìš” ë²„íŠ¼ ìƒ‰ */
                --accent-2: #10b981;
                --text-strong: #1f2937;
            }
            body {
                margin: 0;
                font-family: Inter, system-ui, AppleSDGothicNeo,
                    Apple Color Emoji, Segoe UI Emoji, sans-serif;
                background: var(--bg);
            }

            /* ===== Layout ===== */
            .wrap {
                display: grid;
                grid-template-columns: minmax(0, 1fr) 320px;
                gap: 16px;
                padding: 20px;
            }
            @media (max-width: 1024px) {
                .wrap {
                    grid-template-columns: 1fr;
                }
            }
            .card {
                background: var(--card);
                border: 1px solid var(--border);
                border-radius: 16px;
                box-shadow: 0 2px 12px rgba(0, 0, 0, 0.04);
            }

            /* ===== Editor Card ===== */
            .editor-card {
                display: flex;
                flex-direction: column;
            }
            .toolbar {
                padding: 0;
                border: 0;
            }
            #quill-toolbar.ql-toolbar.ql-snow {
                border: 1px solid var(--border);
                border-bottom: 0;
                border-radius: 12px 12px 0 0;
                padding: 8px 10px;
            }

            #quill .ql-container.ql-snow {
                border: 1px solid var(--border);
                border-top: 0;
                border-radius: 0 0 12px 12px;
                overflow: hidden;
            }
            .editor {
                min-height: 520px;
            }
            #quill .ql-editor {
                padding: 14px 16px;
            }

            .editor-card .footer {
                border-top: 0;
                padding: 8px 12px;
                display: flex;
                justify-content: space-between;
                align-items: center;
            }

            #resultArea:empty {
                display: none;
            }
            .spinner {
                display: none;
                font-size: 12px;
                color: #444;
            }
            .side {
                padding: 16px;
                display: flex;
                flex-direction: column;
                gap: 14px;
            }
            .side h3 {
                margin: 0 0 6px;
                font-size: 16px;
            }
            .panel {
                background: var(--card);
                border: 1px solid var(--border);
                border-radius: 12px;
                padding: 12px;
            }
            .panel + .panel {
                margin-top: 2px;
            }

            .panel-title {
                font-size: 12px;
                letter-spacing: 0.04em;
                text-transform: uppercase;
                color: #8a8fa3;
                font-weight: 800;
                margin-bottom: 10px;
            }
            .grid-2 {
                display: grid;
                grid-template-columns: 1fr 1fr;
                gap: 8px;
            }
            .grid-1 {
                display: grid;
                grid-template-columns: 1fr;
                gap: 8px;
            }

            .sc-btn {
                display: inline-flex;
                align-items: center;
                justify-content: center;
                gap: 8px;
                height: 40px;
                padding: 0 14px;
                border-radius: 10px;
                border: 1px solid var(--border);
                font-weight: 700;
                letter-spacing: 0.2px;
                background: #fff;
                color: var(--text-strong);
                cursor: pointer;
                transition: box-shadow 0.15s ease, transform 0.02s ease,
                    background 0.15s ease;
                user-select: none;
            }
            .sc-btn:hover {
                background: #f7f8fb;
            }
            .sc-btn:active {
                transform: translateY(1px);
            }
            .sc-btn:focus-visible {
                outline: 2px solid transparent;
                box-shadow: 0 0 0 3px rgba(79, 70, 229, 0.25);
            }
            .sc-btn--primary {
                background: var(--accent);
                color: #fff;
                border-color: transparent;
            }
            .sc-btn--primary:hover {
                filter: brightness(1.05);
            }
            .sc-btn--secondary {
                border-color: #d7daf0;
                background: #fff;
            }
            .sc-btn--secondary:hover {
                background: #f5f7ff;
            }

            .sc-select {
                height: 40px;
                padding: 0 38px 0 12px;
                border: 1.5px solid #d7daf0;
                border-radius: 10px;
                background: #fff;
                color: #111827;
                font-weight: 600;
                appearance: none;
                -webkit-appearance: none;
                -moz-appearance: none;
                background-image: url("data:image/svg+xml,%3Csvg width='18' height='18' viewBox='0 0 20 20' fill='none' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M5 7l5 5 5-5' stroke='%238b90a5' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'/%3E%3C/svg%3E");
                background-repeat: no-repeat;
                background-position: right 10px center;
                background-size: 18px 18px;
            }
            .sc-select:hover {
                border-color: #bfc6ee;
            }
            .sc-select:focus {
                outline: none;
                box-shadow: 0 0 0 3px rgba(79, 70, 229, 0.2);
                border-color: var(--accent);
            }

            .row,
            .grid-2,
            .grid-1 {
            }
            .row > .sc-btn,
            .row > .sc-select,
            .grid-2 > .sc-btn,
            .grid-2 > .sc-select,
            .grid-1 > .sc-btn,
            .grid-1 > .sc-select {
                width: 100%;
            }
            .btn {
                padding: 10px 12px;
                border-radius: 12px;
                border: 1px solid var(--border);
                background: #fff;
                cursor: pointer;
                font-weight: 600;
            }
            .btn:hover {
                background: #fafafa;
            }

            /* === Quill ë°•ìŠ¤ ìœ„/ì•„ë˜ ëª¨ì„œë¦¬ í†µì¼ + í’‹í„° ë¼ì¸ ì œê±° (ê°•ì œ ì˜¤ë²„ë¼ì´ë“œ) === */
            .toolbar {
                padding: 0 !important;
                border: 0 !important;
            } /* íˆ´ë°” í­ ë§ì¶”ê¸° */

            #quill-toolbar.ql-toolbar.ql-snow {
                border: 1px solid var(--border) !important; /* íˆ´ë°”ì— ë³´ë” ë¶€ì—¬ */
                border-bottom: 0 !important; /* ì•„ë˜ëŠ” ì…ë ¥ì°½ê³¼ ì ‘í•© */
                border-radius: 12px 12px 0 0 !important; /* ìœ„ìª½ ë‘¥ê·¼ ëª¨ì„œë¦¬ */
            }

            #quill .ql-container.ql-snow {
                border: 1px solid var(--border) !important; /* ì…ë ¥ì°½ì—ë„ ê°™ì€ ë³´ë” */
                border-top: 0 !important; /* ìœ„ëŠ” íˆ´ë°”ì™€ ì ‘í•© */
                border-radius: 0 0 12px 12px !important; /* â†“ ì•„ë˜ë„ ë‘¥ê¸€ê²Œ */
                overflow: hidden !important; /* ë‘¥ê·¼ ëª¨ì„œë¦¬ ê¹¨ë—í•˜ê²Œ */
            }

            .editor-card .footer,
            .footer {
                border-top: 0 !important; /* ì…ë ¥ì°½ ë°”ë¡œ ì•„ë˜ ì§ì„  ì œê±° */
                /* í•„ìš”í•˜ë©´ ê°„ê²© ì‚´ì§: margin-top: 8px; */
            }
        </style>
    </head>
    <body class="index-page">
        <header id="header" class="header d-flex align-items-center sticky-top">
            <div
                class="container position-relative d-flex align-items-center justify-content-between"
            >
                <a
                    href="index.html"
                    class="logo d-flex align-items-center me-auto me-xl-0"
                >
                    <!-- Uncomment the line below if you also wish to use an image logo -->
                    <!-- <img src="assets/img/logo.png" alt=""> -->
                    <h1 class="sitename">StoryCraft</h1>
                </a>

                <nav id="navmenu" class="navmenu">
                    <ul>
                        <!-- <li>
                            <a href="index.html#hero" class="active">Home</a>
                        </li>
                        <li><a href="index.html#about">About</a></li>
                        <li><a href="index.html#services">Services</a></li> -->
                        <li><a href="search.html">Search</a></li>
                        <li><a href="rewrite.html">Rewrite</a></li>
                        <li><a href="change-style.html">Style</a></li>
                        <li><a href="grammar.html">Grammar</a></li>
                        <li><a href="honorific.html">Honorific</a></li>
                        <li><a href="translate.html">Translate</a></li>
                        <li><a href="scan.html">Scan</a></li>
                        <li><a href="image.html">Image Scan</a></li>
                        <li><a href="speech.html">Speech</a></li>
                        <li><a href="editor.html" class="active">Editor</a></li>
                    </ul>
                    <i class="mobile-nav-toggle d-xl-none bi bi-list"></i>
                </nav>
            </div>
        </header>
        <div class="wrap">
            <!-- ì—ë””í„° ì¹´ë“œ -->
            <div class="card editor-card">
                <div class="toolbar">
                    <div id="quill-toolbar">
                        <span class="ql-formats">
                            <select class="ql-header">
                                <option value="1"></option>
                                <option value="2"></option>
                                <option selected></option>
                            </select>
                            <select class="ql-font"></select>
                            <select class="ql-size"></select>
                        </span>
                        <span class="ql-formats">
                            <button class="ql-bold"></button>
                            <button class="ql-italic"></button>
                            <button class="ql-underline"></button>
                            <button class="ql-strike"></button>
                        </span>
                        <span class="ql-formats">
                            <button class="ql-list" value="ordered"></button>
                            <button class="ql-list" value="bullet"></button>
                            <select class="ql-align"></select>
                        </span>
                        <span class="ql-formats">
                            <button class="ql-link"></button>
                            <button class="ql-blockquote"></button>
                            <button class="ql-code-block"></button>
                        </span>
                        <span class="ql-formats">
                            <button class="ql-clean"></button>
                        </span>
                    </div>
                </div>
                <div id="quill" class="editor"></div>
                <div class="footer">
                    <span id="spinner" class="spinner">â³ ì„œë²„ ì²˜ë¦¬ ì¤‘â€¦</span>
                </div>
                <div
                    id="resultArea"
                    class="card"
                    style="margin-top: 12px; padding: 12px"
                ></div>

                <!-- ê³µìš© ìŠ¤í¬ë¦½íŠ¸ê°€ ì½ëŠ” ì…ë ¥ê°’(Quillâ†”ê³µìš© í•¨ìˆ˜ ì—°ê²°ìš©) -->
                <textarea id="userInput" style="display: none"></textarea>
                <input id="styleInput" type="hidden" />
                <input id="translateInput" type="hidden" />
            </div>

            <!-- ì‚¬ì´ë“œ íˆ´ íŒ¨ë„ -->
            <div class="card side">
                <section class="panel">
                    <div class="panel-title">Translate & Import</div>
                    <div class="grid-2" style="margin-bottom: 8px">
                        <select
                            id="sourceSelector"
                            class="sc-select"
                            title="ì›ë³¸ ì–¸ì–´"
                        >
                            <option value="auto" selected>ìë™ ê°ì§€</option>
                            <option value="gu">êµ¬ìë¼íŠ¸ì–´</option>
                            <option value="el">ê·¸ë¦¬ìŠ¤ì–´</option>
                            <option value="ne">ë„¤íŒ”ì–´</option>
                            <option value="nl">ë„¤ëœë€ë“œì–´</option>
                            <option value="de">ë…ì¼ì–´</option>
                            <option value="ru">ëŸ¬ì‹œì•„ì–´</option>
                            <option value="ro">ë£¨ë§ˆë‹ˆì•„ì–´</option>
                            <option value="mr">ë§ˆë¼í‹°ì–´</option>
                            <option value="ms">ë§ë ˆì´ì–´</option>
                            <option value="vi">ë² íŠ¸ë‚¨ì–´</option>
                            <option value="bn">ë²µê³¨ì–´</option>
                            <option value="sv">ìŠ¤ì›¨ë´ì–´</option>
                            <option value="es">ìŠ¤í˜ì¸ì–´</option>
                            <option value="af">ì•„í”„ë¦¬ì¹¸ìŠ¤ì–´</option>
                            <option value="ar">ì•„ëì–´</option>
                            <option value="en">ì˜ì–´</option>
                            <option value="uk">ìš°í¬ë¼ì´ë‚˜ì–´</option>
                            <option value="it">ì´íƒˆë¦¬ì•„ì–´</option>
                            <option value="ja">ì¼ë³¸ì–´</option>
                            <option value="jv">ìë°”ì–´</option>
                            <option value="ka">ì¡°ì§€ì•„ì–´</option>
                            <option value="zh-CN">ì¤‘êµ­ì–´(ê°„ì²´)</option>
                            <option value="zh-TW">ì¤‘êµ­ì–´(ë²ˆì²´)</option>
                            <option value="ta">íƒ€ë°€ì–´</option>
                            <option value="th">íƒœêµ­ì–´</option>
                            <option value="tr">í„°í‚¤ì–´</option>
                            <option value="fa">í˜ë¥´ì‹œì•„ì–´</option>
                            <option value="pt">í¬ë¥´íˆ¬ê°ˆì–´</option>
                            <option value="pl">í´ë€ë“œì–´</option>
                            <option value="fr">í”„ë‘ìŠ¤ì–´</option>
                            <option value="ko">í•œêµ­ì–´</option>
                            <option value="hi">íŒë””ì–´</option>
                        </select>

                        <!-- ëŒ€ìƒ ì–¸ì–´ ì„ íƒ -->
                        <select
                            id="targetSelector"
                            class="sc-select"
                            title="ëŒ€ìƒ ì–¸ì–´"
                        >
                            <option value="gu">êµ¬ìë¼íŠ¸ì–´</option>
                            <option value="el">ê·¸ë¦¬ìŠ¤ì–´</option>
                            <option value="ne">ë„¤íŒ”ì–´</option>
                            <option value="nl">ë„¤ëœë€ë“œì–´</option>
                            <option value="de">ë…ì¼ì–´</option>
                            <option value="ru">ëŸ¬ì‹œì•„ì–´</option>
                            <option value="ro">ë£¨ë§ˆë‹ˆì•„ì–´</option>
                            <option value="mr">ë§ˆë¼í‹°ì–´</option>
                            <option value="ms">ë§ë ˆì´ì–´</option>
                            <option value="vi">ë² íŠ¸ë‚¨ì–´</option>
                            <option value="bn">ë²µê³¨ì–´</option>
                            <option value="sv">ìŠ¤ì›¨ë´ì–´</option>
                            <option value="es">ìŠ¤í˜ì¸ì–´</option>
                            <option value="af">ì•„í”„ë¦¬ì¹¸ìŠ¤ì–´</option>
                            <option value="ar">ì•„ëì–´</option>
                            <option value="en" selected>ì˜ì–´</option>
                            <option value="uk">ìš°í¬ë¼ì´ë‚˜ì–´</option>
                            <option value="it">ì´íƒˆë¦¬ì•„ì–´</option>
                            <option value="ja">ì¼ë³¸ì–´</option>
                            <option value="jv">ìë°”ì–´</option>
                            <option value="ka">ì¡°ì§€ì•„ì–´</option>
                            <option value="zh-CN">ì¤‘êµ­ì–´(ê°„ì²´)</option>
                            <option value="zh-TW">ì¤‘êµ­ì–´(ë²ˆì²´)</option>
                            <option value="ta">íƒ€ë°€ì–´</option>
                            <option value="th">íƒœêµ­ì–´</option>
                            <option value="tr">í„°í‚¤ì–´</option>
                            <option value="fa">í˜ë¥´ì‹œì•„ì–´</option>
                            <option value="pt">í¬ë¥´íˆ¬ê°ˆì–´</option>
                            <option value="pl">í´ë€ë“œì–´</option>
                            <option value="fr">í”„ë‘ìŠ¤ì–´</option>
                            <option value="ko">í•œêµ­ì–´</option>
                            <option value="hi">íŒë””ì–´</option>
                        </select>
                    </div>

                    <div class="grid-1">
                        <button
                            class="sc-btn sc-btn--primary"
                            id="btn-translate"
                        >
                            ğŸŒ ë²ˆì—­
                        </button>
                    </div>
                </section>

                <div class="hr"></div>

                <!-- ë¬¸ì²´ & í†¤ -->
                <section class="panel">
                    <div class="panel-title">Style & Tone</div>
                    <div class="grid-2" style="margin-bottom: 8px">
                        <select
                            id="styleSelector"
                            class="sc-select"
                            title="ë¬¸ì²´ ì„ íƒ"
                        >
                            <option value="casual">êµ¬ì–´ì²´</option>
                            <option value="formal">ê²©ì‹ì²´</option>
                            <option value="literary">ë¬¸í•™ì²´</option>
                            <option value="academic">í•™ìˆ ì²´</option>
                        </select>
                        <button
                            class="sc-btn sc-btn--secondary"
                            id="btn-style"
                            onclick="applyStyle()"
                        >
                            âœ’ï¸ ë¬¸ì²´ë³€ê²½
                        </button>
                    </div>

                    <div class="grid-2">
                        <button class="sc-btn" id="btn-honorific">
                            ğŸ™‡ ë†’ì„ë§
                        </button>
                        <button class="sc-btn" id="btn-informal">
                            ğŸ™‚ ë°˜ë§
                        </button>
                    </div>
                </section>

                <div class="hr"></div>

                <!-- ì²¨ì‚­/ìš”ì•½/í™•ì¥ -->
                <section class="panel">
                    <div class="panel-title">Rewrite & Summary</div>
                    <div class="grid-2" style="margin-bottom: 8px">
                        <button
                            class="sc-btn sc-btn--secondary"
                            id="btn-rewrite"
                        >
                            ğŸ› ï¸ ì²¨ì‚­
                        </button>
                        <button
                            class="sc-btn sc-btn--secondary"
                            id="btn-summary"
                        >
                            ğŸ§¾ ìš”ì•½
                        </button>
                    </div>
                    <div class="grid-1">
                        <button class="sc-btn" id="btn-expand">â• í™•ì¥</button>
                    </div>
                </section>
                <!-- ë¬¸ë²• êµì • -->
                <section class="panel">
                    <div class="panel-title">Grammar</div>
                    <div class="grid-1">
                        <button
                            class="sc-btn sc-btn--secondary"
                            id="btn-grammar"
                        >
                            âœ”ï¸ ë¬¸ë²• êµì •
                        </button>
                    </div>
                </section>

                <section class="panel sticky">
                    <div class="panel-title">Export</div>
                    <div class="grid-1">
                        <button
                            class="sc-btn sc-btn--secondary"
                            id="pdfDownloadBtn"
                        >
                            â¬‡ï¸ PDFë¡œ ì €ì¥
                        </button>
                    </div>
                </section>
            </div>
        </div>

        <script src="https://cdn.jsdelivr.net/npm/quill@1.3.7/dist/quill.min.js"></script>
        <script>
            // ===== 0) í™˜ê²½ =====
            const BASE_URL = 'http://127.0.0.1:8000'; // â† ë„¤ FastAPI ì£¼ì†Œë¡œ ë³€ê²½
            const $spinner = document.getElementById('spinner');

            // ===== 1) Quill ì´ˆê¸°í™” =====
            const quill = new Quill('#quill', {
                modules: { toolbar: '#quill-toolbar' },
                theme: 'snow',
                placeholder: 'ì—¬ê¸°ì— ë¬¸ì„œë¥¼ ì‘ì„±í•˜ì„¸ìš”â€¦',
            });

            // ìœ í‹¸: í…ìŠ¤íŠ¸ â†” ë¸íƒ€ ì—…ë°ì´íŠ¸
            function setEditorText(text) {
                // ë®ì–´ì“°ê¸° (í•„ìš”í•˜ë©´ diff/mergeë¡œ ë°”ê¿€ ìˆ˜ ìˆìŒ)
                quill.setText(text || '');
            }
            function getEditorText() {
                return quill.getText(); // ì„œì‹ ì œì™¸ ìˆœìˆ˜ í…ìŠ¤íŠ¸
            }
            function showSpin(v) {
                $spinner.style.display = v ? 'inline' : 'none';
            }

            // ===== 2) ê³µí†µ í˜¸ì¶œ í•¨ìˆ˜ =====
            async function postJSON(url, payload) {
                const res = await fetch(url, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload),
                });
                if (!res.ok) {
                    const t = await res.text();
                    throw new Error(`HTTP ${res.status} - ${t}`);
                }
                return res.json();
            }

            // ===== 3) ê° ê¸°ëŠ¥ í•¸ë“¤ëŸ¬ =====
            async function doRewrite() {
                const content = getEditorText().trim();
                if (!content) {
                    alert('ë‚´ìš©ì„ ì…ë ¥í•˜ì„¸ìš”.');
                    return;
                }
                showSpin(true);
                try {
                    const data = await postJSON(`${BASE_URL}/mistralRewrite`, {
                        content,
                    });
                    setEditorText((data.result || '').trim());
                } catch (e) {
                    alert('ì²¨ì‚­ ì‹¤íŒ¨: ' + e.message);
                } finally {
                    showSpin(false);
                }
            }

            async function doSummary() {
                const content = getEditorText().trim();
                if (!content) {
                    alert('ë‚´ìš©ì„ ì…ë ¥í•˜ì„¸ìš”.');
                    return;
                }
                showSpin(true);
                try {
                    const data = await postJSON(`${BASE_URL}/summary`, {
                        content,
                    }); // ë„¤ê°€ ì“°ëŠ” ìš”ì•½ ì—”ë“œí¬ì¸íŠ¸ ì´ë¦„ìœ¼ë¡œ ë³€ê²½
                    setEditorText((data.result || '').trim());
                } catch (e) {
                    alert('ìš”ì•½ ì‹¤íŒ¨: ' + e.message);
                } finally {
                    showSpin(false);
                }
            }

            async function doExpand() {
                const content = getEditorText().trim();
                if (!content) {
                    alert('ë‚´ìš©ì„ ì…ë ¥í•˜ì„¸ìš”.');
                    return;
                }
                showSpin(true);
                try {
                    const data = await postJSON(`${BASE_URL}/expand`, {
                        content,
                    }); // í™•ì¥ ì—”ë“œí¬ì¸íŠ¸ë¡œ ë³€ê²½
                    setEditorText((data.result || '').trim());
                } catch (e) {
                    alert('í™•ì¥ ì‹¤íŒ¨: ' + e.message);
                } finally {
                    showSpin(false);
                }
            }

            async function doStyle() {
                const content = getEditorText().trim();
                const style = document.getElementById('styleSelector').value;

                if (!content) {
                    alert('ë‚´ìš©ì„ ì…ë ¥í•˜ì„¸ìš”.');
                    return;
                }
                showSpin(true);

                try {
                    const data = await postJSON(`${BASE_URL}/gptStyleChange`, {
                        text: content,
                        style: style,
                    }); // í•„ìš” íŒŒë¼ë¯¸í„° ë§ì¶° ìˆ˜ì •
                    setEditorText((data.styled_text || '').trim());
                } catch (e) {
                    alert('ë¬¸ì²´ë³€ê²½ ì‹¤íŒ¨: ' + e.message);
                } finally {
                    showSpin(false);
                }
            }

            async function doHonorific() {
                const content = getEditorText().trim();
                if (!content) {
                    alert('ë‚´ìš©ì„ ì…ë ¥í•˜ì„¸ìš”.');
                    return;
                }
                showSpin(true);
                try {
                    const data = await postJSON(`${BASE_URL}/cohereHonorific`, {
                        content,
                    });
                    setEditorText((data.result || '').trim());
                } catch (e) {
                    alert('ë†’ì„ë§ ë³€í™˜ ì‹¤íŒ¨: ' + e.message);
                } finally {
                    showSpin(false);
                }
            }

            async function doInformal() {
                const content = getEditorText().trim();
                if (!content) {
                    alert('ë‚´ìš©ì„ ì…ë ¥í•˜ì„¸ìš”.');
                    return;
                }
                showSpin(true);
                try {
                    const data = await postJSON(`${BASE_URL}/cohereInformal`, {
                        content,
                    });
                    setEditorText((data.result || '').trim());
                } catch (e) {
                    alert('ë°˜ë§ ë³€í™˜ ì‹¤íŒ¨: ' + e.message);
                } finally {
                    showSpin(false);
                }
            }

            async function doTranslate() {
                const content = getEditorText().trim();
                if (!content) {
                    alert('ë‚´ìš©ì„ ì…ë ¥í•˜ì„¸ìš”.');
                    return;
                }
                showSpin(true);
                try {
                    const data = await postJSON(`${BASE_URL}/translate`, {
                        text: content,
                        source: 'auto',
                        target: 'en',
                    });
                    setEditorText(
                        (data.translated || data.result || '').trim()
                    );
                } catch (e) {
                    alert('ë²ˆì—­ ì‹¤íŒ¨: ' + e.message);
                } finally {
                    showSpin(false);
                }
            }

            async function doOCRorFile() {
                const file = document.getElementById('file-input').files[0];
                if (!file) {
                    alert('íŒŒì¼ì„ ì„ íƒí•˜ì„¸ìš”.');
                    return;
                }

                const form = new FormData();
                // ì„œë²„ êµ¬í˜„ì— ë§ì¶° í•„ë“œëª… ì„ íƒ:
                // 1) ì´ë¯¸ì§€ OCR: 'image'
                // 2) ì¼ë°˜ ë¬¸ì„œ ì¶”ì¶œ: 'file' ë˜ëŠ” ë„¤ ì„œë²„ì˜ /fileScan ê·œì•½
                if (/\.(png|jpg|jpeg|bmp|tif|tiff)$/i.test(file.name)) {
                    form.append('image', file);
                    await uploadTo(`${BASE_URL}/visionOCR`, form, 'text');
                } else {
                    form.append('file', file);
                    await uploadTo(`${BASE_URL}/fileScan`, form, 'text');
                }
            }
            async function doGrammar() {
                const content = getEditorText().trim();
                if (!content) {
                    alert('ë‚´ìš©ì„ ì…ë ¥í•˜ì„¸ìš”.');
                    return;
                }
                showSpin(true);
                try {
                    const data = await postJSON(`${BASE_URL}/editorGrammar`, {
                        content,
                    });
                    setEditorText((data.checked || '').trim());
                } catch (e) {
                    alert('ë¬¸ë²• êµì • ì‹¤íŒ¨: ' + e.message);
                } finally {
                    showSpin(false);
                }
            }
            async function uploadTo(url, form, expectField = 'text') {
                showSpin(true);
                try {
                    const res = await fetch(url, {
                        method: 'POST',
                        body: form,
                    });
                    if (!res.ok) {
                        throw new Error(
                            `HTTP ${res.status} - ${await res.text()}`
                        );
                    }
                    const data = await res.json();
                    const text = (
                        data[expectField] ||
                        data.result ||
                        ''
                    ).toString();
                    setEditorText(text.trim());
                } catch (e) {
                    alert('ë¶ˆëŸ¬ì˜¤ê¸° ì‹¤íŒ¨: ' + e.message);
                } finally {
                    showSpin(false);
                }
            }

            // ===== 4) ë²„íŠ¼ ë°”ì¸ë”© =====
            document.addEventListener('DOMContentLoaded', () => {
                document.getElementById('btn-rewrite').onclick = doRewrite;
                document.getElementById('btn-summary').onclick = doSummary;
                document.getElementById('btn-expand').onclick = doExpand;
                document.getElementById('btn-style').onclick = doStyle;
                document.getElementById('btn-honorific').onclick = doHonorific;
                document.getElementById('btn-informal').onclick = doInformal;
                document.getElementById('btn-translate').onclick = doTranslate;
                document.getElementById('btn-grammar').onclick = doGrammar;
                document.getElementById('btn-ocr').onclick = doOCRorFile;
            });
        </script>

        <!-- Preloader -->
        <div id="preloader"></div>

        <!-- Vendor JS Files -->
        <script src="assets/vendor/bootstrap/js/bootstrap.bundle.min.js"></script>
        <script src="assets/vendor/php-email-form/validate.js"></script>
        <script src="assets/vendor/aos/aos.js"></script>
        <script src="assets/vendor/glightbox/js/glightbox.min.js"></script>
        <script src="assets/vendor/imagesloaded/imagesloaded.pkgd.min.js"></script>
        <script src="assets/vendor/isotope-layout/isotope.pkgd.min.js"></script>
        <script src="assets/vendor/swiper/swiper-bundle.min.js"></script>

        <script src="assets/js/script.js"></script>
        <script src="assets/js/main.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.9.2/html2pdf.bundle.js"></script>
        <script>
            (function () {
                function setHeaderH() {
                    var h =
                        (document.getElementById('header') || {})
                            .offsetHeight || 64;
                    document.documentElement.style.setProperty(
                        '--header-h',
                        h + 'px'
                    );
                }
                window.addEventListener('load', setHeaderH);
                window.addEventListener('resize', setHeaderH);
                setHeaderH();
            })();
        </script>
    </body>
</html>
